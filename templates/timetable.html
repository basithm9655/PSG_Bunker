{% extends "base.html" %}

{% block content %}
<div class="timetable-container">
    <div class="timetable-header">
        <h1><i class="fas fa-calendar-alt"></i> Weekly Timetable</h1>
        <div class="timetable-actions">
            <button class="btn-secondary" onclick="refreshTimetable()">
                <i class="fas fa-redo"></i> Refresh
            </button>
        </div>
    </div>

    {% if message and not timetable_data %}
    <div class="empty-state glass-card">
        <i class="fas fa-calendar-times"></i>
        <h3>No Timetable Data</h3>
        <p>{{ message }}</p>
    </div>
    {% elif timetable_data %}
    <div class="timetable-wrapper glass-card">
        <div class="timetable-grid">
            <!-- Time slots header -->
            <div class="time-slot-header"></div>
            {% for time in ['8:30-9:20', '9:20-10:10', '10:30-11:20', '11:20-12:10', 
                           '1:40-2:30', '2:30-3:20', '3:30-4:20', '4:20-5:10',
                           '5:30-6:20', '6:20-7:10', '7:15-8:05', '8:05-8:55'] %}
            <div class="time-slot">{{ time }}</div>
            {% endfor %}

            <!-- Days and classes -->
            {% for day, slots in timetable_data.items() %}
            <div class="day-header">{{ day }}</div>
            {% for time_slot in ['8:30-9:20', '9:20-10:10', '10:30-11:20', '11:20-12:10', 
                                '1:40-2:30', '2:30-3:20', '3:30-4:20', '4:20-5:10',
                                '5:30-6:20', '6:20-7:10', '7:15-8:05', '8:05-8:55'] %}
            <div class="class-slot">
                {% if slots.get(time_slot) %}
                <div class="class-card" data-course="{{ slots[time_slot].course_code }}">
                    <div class="class-code">{{ slots[time_slot].course_code }}</div>
                    <div class="class-name">{{ slots[time_slot].course_name }}</div>
                    <div class="class-actions">
                        <button class="btn-small" onclick="planBunk('{{ slots[time_slot].course_code }}')">
                            <i class="fas fa-calculator"></i> Plan Bunk
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
            {% endfor %}
        </div>
    </div>

    <div class="timetable-stats glass-card">
        <h3><i class="fas fa-chart-bar"></i> Weekly Summary</h3>
        <div class="stats-grid">
            {% for day, slots in timetable_data.items() %}
            <div class="day-stat">
                <span class="day-name">{{ day }}</span>
                <span class="class-count">{{ slots|length }} classes</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Bunk Planning Modal -->
<div id="timetableBunkModal" class="modal-overlay">
    <div class="modal-content glass-card">
        <div class="modal-header">
            <h3><i class="fas fa-calculator"></i> Plan Bunk for <span id="bunkCourseName"></span></h3>
            <button class="close-btn" onclick="closeModal('timetableBunkModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Number of Classes to Bunk</label>
                <input type="number" id="timetableBunks" class="form-input" min="0" value="1">
            </div>
            <div id="timetablePlannerResult" class="planner-result"></div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeModal('timetableBunkModal')">Cancel</button>
            <button class="btn-primary" onclick="calculateTimetableBunk()">Calculate Impact</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/timetable.js') }}"></script>
{% endblock %}
